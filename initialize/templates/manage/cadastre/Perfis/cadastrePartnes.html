{% extends 'base.html' %}
{% load static %}
{% block title %}Shiloh | Cadastrar Parceiros{% endblock %}
{% block icon-page %}
metismenu-icon lnr-apartment icon-gradient bg-sunny-morning
{% endblock %}
{% block title-page %}
Página inicial
{% endblock %}
{% block description-page %}
CADASTRAR PARCEIRO{% endblock %}
{% block content %}

<style type="text/css">
   .corfont{
   color: #641108;
   font-weight: bold;
   }
</style> 

<div class="breadcrumbs-dark pb-0" id="breadcrumbs-wrapper">
<div class="container">
   <div class="card" >
      <div class="row">
         <div class="container">
            <div class="col s12 m12 m-b10" style="padding-left: 10px;">
               <div class="active">
                  <div class="collapsible-header col m6 s12 " style="height: 40px; margin-top: 10px; background-color: #581848; color: white;" tabindex="0">
                     <labe style="margin-top: 0.2em; font-size: 20px; font-weight: bold;">Selecione:</labe>
                  </div>
               </div>
            </div>
            <div class=" col s3 m3 mb-5" style="margin-top: 30px;">
               <label>
               <input id="shiloh_lab" value="1" class="with-gap" type="radio" name="option"/>
               <span style="padding-left: 25px;">ShilohLab</span>
               </label>
            </div>
            <!-- <div class="container col s3 m3" style="margin-top: 30px;">
               <label>
               <input id="lab_movel" value="2" class="with-gap" type="radio" name="option"/>
               <span style="padding-left: 25px;">LabMovel</span>
               </label>
            </div> -->
         </div>
      </div>
         <!-- Externo -->
      <div id="card_partnerss" class="row"  style="display: none;">
        <div class="col s12 s12"  style="margin-top: 0px;">
          <div class="input-field col m6 s12">
             <input id="name" type="text" class="upper">
             <label for="name">
             <i class="material-icons" style="font-size: 15px">person</i>&nbsp;Nome Completo<span style="color: red;">*</span></label>
          </div>
          <div class="input-field col m2 s12">
            <input id="rn" type="text" >
            <label for="rn">
            <i class="material-icons" style="font-size: 15px">featured_play_list</i>&nbsp;NC</label>
         </div>
         <div class="input-field col m4 s12" >
            <div class="select-wrapper">
              <select name="select" id="categoria" onchange="SelectShow()" class="error " data-required='true'>
                  <option value="">Categoria</option>
                  {% for k in arr_SearchCategoria %}
                  <option value="{{ k.id }}">{{ k.categoria }}</option>
                  {% endfor %}
              </select>
            </div>
        </div>
       </div>
       <div class="col s12">
          <div class="input-field col m8 s12" >
             <input id="email" type="email" data-required='true'>
             <label for="email">
             <i class="material-icons" style="font-size: 15px">email</i>&nbsp;E-mail</label>
          </div>
          <div class="input-field col m2 s12">
             <input id="tel1" type="tel" data-required='true'>
             <label for="tel1">
             <i class="material-icons" style="font-size: 15px">phone</i>&nbsp;Telefone 1 <span style="color: red;">*</span></label>
          </div>
          <div class="input-field col m2 s12">
             <input id="tel2" type="tel">
             <label for="tel2">
             <i class="material-icons" style="font-size: 15px">phone</i>&nbsp;Telefone 2</label>
          </div>
       </div>
       <div class="col s12">
          <div class="input-field col m3 s12">
             <input id="zipcode" type="text"  maxlength="9" onblur="pesquisacep(this.value)" data-required='true'>
             <label for="zipcode">
             <i class="material-icons" style="font-size: 15px">place</i>&nbsp;CEP </label>
          </div>
          <div class="input-field col m7 s10">
             <input id="addres" type="text" data-required='true'>
             <label for="addres">Logradouro </label>
          </div>
          <div class="input-field col m2 s2" >
             <input id="number" type="text" data-required='true'>
             <label for="number">Número </label>
          </div>
       </div> 
       <div class="col s12">
         <div class="input-field col m3 s12">
            <input id="complement">
            <label for="complement">Complemento</label>
         </div>
         <div class="input-field col m5 s6">
           <input id="district" type="text" data-required='true'>
           <label for="district">Bairro</label>
        </div>
         <div class="input-field col m2 s3">
           <input id="city" type="text" data-required='true'>
           <label for="city">Cidade</label>
        </div>
        <div class="input-field col m2 s3">
           <input id="uf" type="text"  maxlength="2" data-required='true'>
           <label for="uf">UF</label>
        </div>

       </div>
       <div class="input-field col s12 m12">
         <div class="input-field col s12 m12" >
            <input id="obs" type="text" >
            <label for="obs">
               <i class="material-icons" style="font-size: 15px">mode_edit</i>&nbsp;Observação</label>
         </div>
      </div>
      <!--FINANCEIRO-->
         <div class="col s12 m12">
               <div class="active">
                  <div class="collapsible-header col m4 s6 " style="height: 40px; background-color: #c434a07e; color: white;" tabindex="0">
                     <labe style="margin-top: 0.2em; font-size: 20px; font-weight: bold;">Financeiro</labe>
                  </div>
               </div>
         </div>
         <div id="financeiro">
            <div class="col s12 m12 " >
               <div class="col m6 s12">
                  <div class="input-field col s3   ">
                     <label>
                     <input type="checkbox" id="val_p_fixo_check" class="checkgroup" onclick="padrao()">
                     <span>Valor Padrão:</span>
                     </label>
                  </div>
                  <div class="input-field col m5 s12">
                     <input readonly="readonly" type="text" id="val_p_fixo" class="inpd" style="color:black;">
                  </div>
               </div>
            </div>
            <div class="col m12 s12">
               <div class="col m6 s12">
                  <div class="input-field col m3 s12">
                     <label>
                     <input type="checkbox" id="val_p_check" class="checkgroup" onclick="porcentagem()">
                     <span>Porcentagem:</span>
                     </label>
                  </div>
                  <div class="input-field col m5 s12">
                     <input type="text" id="val_p" class="inpd" onchange="porcentagem()">
                  </div>
               </div>
            </div>
            <div class="col m12 s12">
               <div class="col m6 s12">
                  <div class="input-field col m3 s12">
                     <label>
                     <input type="checkbox" id="val_fixo_check" class="checkgroup" onclick="fixo()" >
                     <span>Valor Fixo:</span>
                     </label>
                  </div>
                  <div class="input-field col m5 s12">
                     <input type="text" id="val_fixo" class="inpd" onchange="fixo()">
                  </div>
               </div>
            </div>
         </div>
         <!--BUTTON-->
         <div class="col s12 m12">
            <div class="col m6 s12 mb-2"></div>
            <div class="col m3 s12 mb-2">
               <button onclick="CadastrePrePartners()" id="btn_precadastro" class="waves-effect waves dark btn next-step" type="submit" style="width: 100%; margin-top: 10px; background-color: #444054;">
               <span style="font-weight: bold; color: white; font-family:Verdana, Geneva, Tahoma, sans-serif">Pré-Cadastro</spanpx>
               </button>
            </div>
            <div class="col m3 s12 mb-2">
               <button disabled onclick="CadastrePartners()"id="btn_cadastrar" class="waves-effect waves dark btn next-step" type="submit" style="width: 100%; margin-top: 10px">
               <span style="font-weight: bold; color: white; font-family:Verdana, Geneva, Tahoma, sans-serif">Cadastrar</spanpx>
               </button>
            </div>
         </div>
      </div>
   
   </div>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.maskedinput/1.3.1/jquery.maskedinput.min.js"></script>
<script type="text/javascript" src="/app-assets/js/jquery.mask.js"></script>
<script type="text/javascript">





function SelectShow() {
  var show = document.getElementById("categoria").value;
      $("#btn_cadastrar").attr("disabled", true);   
      
      if(show == ''){
         alert("Por favor, preencha um tipo de Categoria")
        }else{
      $("#btn_cadastrar").attr("disabled", false);
        }
}

      $("#tel1").mask("(99) 99999-9999");
      $("#tel2").mask("(99) 99999-9999");
      $("#zipcode").mask("99999-999");
      $("#val_fixo").mask('#.##0,00', {
         reverse: true
      }); 
      $("#val_p").mask('99%', {
         reverse: true
      });
   
   
   function CadastrePartners(){
      email = $("#email").val()

      //VALIDAÇÃO DE CAMPO EMAIL
      var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,})+$/; // filtro
      if(!filter.test(email) && email != ""){
         alert('Insira um email válido.'); 
         $("#email").focus(); 
         return false;
      }

      //VALIDAÇÃO DE CAMPO NULL  
      var i = 0;
         $("#card_partnerss input[data-required='true']").each(function(){
         if($(this).val() == ""){
            alert("Preencha os campos obrigatórios.");
            $(this).focus();
            i = 1;
            return false;
         }
      });
      if(i == 1){
         return false;
      }
      
      shiloh = $("#shiloh_lab").prop("checked")
      movel = $("#lab_movel").prop("checked")

      if (shiloh){
         empresa = shiloh = $("#shiloh_lab").val()
      }else{
         empresa = movel = $("#lab_movel").val()
      }

      //validação do financeiro
      var val_p_fixo = $("#val_p_fixo").val();
      var checkbox_porcentagem = $("#val_p").val();
      var checkbox_fixo = $("#val_fixo").val();

      if(val_p_fixo == "" && checkbox_porcentagem == "" && checkbox_fixo ==""){
         alert("Por favor, insira um valor válido ao Financeiro.")
         return false

      }else{

         var val_p_fixo = $("#val_p_fixo").val();
         var checkbox_porcentagem = $("#val_p").val();
         var checkbox_fixo = $("#val_fixo").val();

         var btncadastrar = {"csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(), 
            "categoria": $('#categoria').val(), 
            "name": $('#name').val(),
            "email": $('#email').val(),
            "tel1": $('#tel1').val(),
            "tel2": $('#tel2').val(),
            "zipcode": $('#zipcode').val(),
            "addres": $('#addres').val(),
            "number": $('#number').val(),
            "complement": $('#complement').val(),
            "district": $('#district').val(),
            "city": $('#city').val(),
            "uf": $('#uf').val(),
            "rn": $('#rn').val(),
            "categoria": $('#categoria').val(),
            "obs": $('#obs').val(),
            "padrao": val_p_fixo,
            "porcentagem": checkbox_porcentagem,
            "fixo": checkbox_fixo,
            "empresa": empresa,

            };
         fetchRequest("{% url 'ApiCadastrePartners' %}", "POST", "JSON", btncadastrar, function(re){
            if(re["response"] == "true"){
               alert(re["message"]);
               $("#btn_cadastrar").attr("disabled", true);
               $("#btn_precadastro").attr("disabled", true);

               location.reload();
            }   
         });
      }  
   };

   function padrao(){
   var checkbox_padrao = $("#val_p_fixo").val();

   if($("#val_p_fixo_check").is(":checked")){
      $("#val_p, #val_fixo").attr("disabled", true)
      $("#val_p_check, #val_fixo_check").attr('disabled',true);
      $("#val_p_fixo").val("R$ 400,00");    

   }
   else{
      $("#val_p, #val_fixo").attr("disabled", false)
      $("#val_p_check, #val_fixo_check").attr('disabled',false);
      $("#val_p, #val_fixo,  #val_p_fixo").val("");    
   }
}

   function porcentagem(){
   var checkbox_porcentagem = $("#val_p").val();

   if($("#val_p_check").is(":checked")){
      $("#val_fixo").attr("disabled", true)
      $("#val_p_fixo_check, #val_fixo_check").attr('disabled',true);
   }else{
      $("#val_fixo").attr("disabled", false)
      $("#val_p_fixo_check, #val_fixo_check").attr('disabled',false);
      $("#val_p, #val_fixo").val("");
   }
}

   function fixo(){
   var checkbox_fixo = $("#val_fixo").val();

   if($("#val_fixo_check").is(":checked")){
      $("#val_p ").attr('disabled',true);
      $("#val_p_fixo_check, #val_p_check").attr("disabled", true)
   }else{
      $("#val_p ").attr('disabled',false);
      $("#val_p_fixo_check, #val_p_check").attr("disabled", false)
      $("#val_p, #val_fixo").val("");
   }
}
   
   // CEP 
   function pesquisacep(valor) {
      var cep = valor.replace(/\D/g, '');
   
      if (cep != "") {
         var validacep = /^[0-9]{8}$/;
         if(validacep.test(cep)) {
            var end_addres = $("#addres").val("...");
            var end_district = $("#district").val("...");
            var end_city = $("#city").val("...");
            var end_state = $("#uf").val("...");
            var script = document.createElement('script');
   
            script.src = 'https://viacep.com.br/ws/'+ cep + '/json/?callback=bsccep';
            document.body.appendChild(script);
         } 
         else {
            limocamp();
            alert("Formato de CEP inválido.");
         }
      }
      else {
         limocamp();
      }
      };
   
   function bsccep(val) {
      if (!("erro" in val)) {
         var end_addres = $("#addres").val(val.logradouro);
         var end_district = $("#district").val(val.bairro);
         var end_city = $("#city").val(val.localidade);
         var end_state = $("#uf").val(val.uf);
      } 
      else {
         limocamp();
         alert("CEP não encontrado no CORREIOS. Entre no site: https://www.correios.com.br/ e pesquise um cep válido.");
      }
   }
   
   function limocamp() {
   var end_zipcode = $("#zipcode").val("");
   var end_addres = $("#addres").val("");
   var end_number = $("#number").val("");
   var end_district = $("#district").val("");
   var end_city = $("#city").val("");
   var end_state = $("#uf").val("");
   }

         
//APARECE CARD
$(".with-gap").click(function() {
   $("#card_partnerss").show();

});


   function CadastrePrePartners(){

      var categoria = $('#categoria').val();
      var name = $('#name').val();
      var email = $('#email').val();
      var tel1 = $('#tel1').val();
      var tel2 = $('#tel2').val();
      var zipcode = $('#zipcode').val();
      var addres = $('#addres').val();
      var number = $('#number').val();
      var complement = $('#complement').val();
      var district = $('#district').val();
      var city = $('#city').val();
      var uf = $('#uf').val();
      var rn = $('#rn').val();
      var obs = $('#obs').val();
      var padrao = $('#val_p_fixo').val();
      var porcentagem = $('#val_p').val();
      var fixo = $('#val_fixo').val();
      var shiloh = $('#shiloh_lab').val();
      var movel = $('#lab_movel').val();

      var shiloh = $("#shiloh_lab").prop("checked")
      var movel = $("#lab_movel").prop("checked")

      
      //VALIDAÇÃO DE CAMPO EMAIL
      var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,})+$/; // filtro
      if(!filter.test(email) && email != ""){
         alert('Insira um email válido.');
         $("#email").focus();
         return false;
      }


      if (shiloh){
         empresa = shiloh = $("#shiloh_lab").val()
      }else{
         empresa = movel = $("#lab_movel").val()
      }


      if(name == "" || tel1 == ""){
         alert("Preencha os campos obrigatórios.");
         $("#btn_precadastro").attr("disabled", false);
            return false;

      }else{
      var btnprecadastro = {
         "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(), 
         "categoria": categoria, 
         "name": name,
         "email": email,
         "tel1": tel1,
         "tel2": tel2,
         "zipcode": zipcode,
         "addres": addres,
         "number": number,
         "complement": complement,
         "district": district,
         "city": city,
         "uf": uf,
         "rn": rn,
         "obs": obs,
         "padrao": padrao,
         "porcentagem": porcentagem,
         "fixo": fixo,
         "empresa": empresa,
      };
      
      fetchRequest("{% url 'ApiCadastrePrePartners' %}", "POST", "JSON", btnprecadastro, function(re){
         if(re["response"] == "true"){
            $("#btn_precadastro").attr("disabled", true);
            $("#btn_cadastrar").attr("disabled", true);
            alert(re["message"]);
            location.reload();
         }
      });
   }
};

</script>

{% endblock %}
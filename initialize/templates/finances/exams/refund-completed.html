{% extends 'base.html' %}
{% load static %}
{% block title %}Página principal{% endblock %}
{% block icon-page %}
metismenu-icon lnr-apartment icon-gradient bg-sunny-morning
{% endblock %}
{% block title-page %}
Página inicial
{% endblock %}
{% block description-page %}
Acompanhe as últimas notícias!
{% endblock %}
{% block content %}
<style type="text/css">
   .corfont{
   color: #641108;
   font-weight: bold;
   }
</style>
<!-- INICIO DO MODAL -->
<div id="modal1" class="modal modal-fixed-footer" style="width: 85%; height: 90%;max-height: 85%">
   <div class="modal-content">
      <div class="card-content" style="margin-top: 50px;">
         <div class="container ">
            <ul class="collapsible expandable " >
               <li class="active" >
                  <div class="collapsible-header col s12" style=" justify-content: center; height: 50px; background-color: #76c076da; color: white;" >
                     <labe style="margin-top: 0.5em; font-size: 20px; font-weight: bold;">DADOS DO AGENDAMENTO</labe>
                  </div>
                  <div id="card_ag" class="row" >
                     <div class="col s12"  style="margin-top: 10px;">
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="date_age" type="date" >
                           <label for="date_age">Data Agendamento</label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="hr_age" type="text" placeholder="00:00">
                           <label for="hr_age">
                           <i class="material-icons" style="font-size: 15px">access_time</i>&nbsp;Horário</label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="tp_service" type="tel"/>
                           <label for="tp_service" class="active">
                           <i class="material-icons" style="font-size: 15px">phone</i>&nbsp;Tipo de Serviço 
                           </label>
                        </div>
                        <div class="input-field col s3" >
                           <input readonly="readonly" style="color: black;"id="tp_exame" type="tel" id>
                           <label for="tp_exame" class="active">
                           <i class="material-icons" style="font-size: 15px">phone</i>&nbsp;Tipo do Exame </label>
                        </div>
                     </div>
                     <div class="input-field col s12" >
                        <div class="input-field col s3" >
                           <input readonly="readonly" style="color: black;"id="tp_conv" type="tel" id>
                           <label for="tp_conv" class="active">
                           <i class="material-icons" style="font-size: 15px">phone</i>&nbsp;Convênio </label>
                        </div>
                        <div class="input-field col s3" >
                           <input readonly="readonly" style="color: black;"id="nurse" type="tel" id>
                           <label for="nurse" class="active">
                           <i class="material-icons" style="font-size: 15px">phone</i>Enfermeiro </label>
                        </div>
                        <div class="input-field col s3" >
                           <input readonly="readonly" style="color: black;"id="driver" type="tel" id>
                           <label for="driver" class="active">
                           <i class="material-icons" style="font-size: 15px">phone</i>Motorista </label>
                        </div>
                     </div>
                  </div>
               </li>
               <!--CARD 2-->
               <li class="active"  style="margin-top: 30px;">
                  <div class="collapsible-header col s12" style=" justify-content: center; height: 50px; background-color: #76c076da; color: white;" >
                     <labe style="margin-top: 0.5em; font-size: 20px; font-weight: bold;">PACIENTE</labe>
                  </div>
                  <div id="userint" class="row" >
                     <div class="col s12"  style="margin-top: 10px;">
                        <div class="input-field col s6">
                           <input readonly="readonly" style="color: black;"id="namePaciente" type="tel" id style="color: black;">
                           <label for="namePaciente" class="active">
                           <i class="material-icons" style="font-size: 15px">phone</i>Nome do Paciente </label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="tel1" type="tel" id>
                           <label for="tel1">
                           <i class="material-icons" style="font-size: 15px">phone</i>&nbsp;Telefone 1</label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="tel2" type="tel" id>
                           <label for="tel2">
                           <i class="material-icons" style="font-size: 15px">phone</i>&nbsp;Telefone 2</label>
                        </div>
                        <div class="input-field col s3" >
                           <input readonly="readonly" style="color: black;"id="resp_comercial" type="tel" id>
                           <label for="resp_comercial">
                           <i class="material-icons" style="font-size: 15px">person</i>&nbsp;Comercial  </label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="doctor" type="tel" id>
                           <label for="doctor" >
                           <i class="material-icons" style="font-size: 15px">person</i>&nbsp;Médico  </label>
                        </div>
                        <div class="input-field col s3" >
                           <input readonly="readonly" style="color: black;"id="attendance" type="tel" id>
                           <label for="attendance">
                           <i class="material-icons" style="font-size: 15px">person</i>&nbsp;Atendimento  </label>
                        </div>
                     </div>
                  </div>
               </li>
               <!--CARD 3-->
               <li class="active" style="margin-top: 30px;" >
                  <div class="collapsible-header col s12" style=" justify-content: center; height: 50px; background-color: #76c076da; color: white;" >
                     <labe style="margin-top: 0.5em; font-size: 20px; font-weight: bold;">ENDEREÇO</labe>
                  </div>
                  <div id="userint" class="row" >
                     <div class="col s12"  style="margin-top: 10px;">
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="zipcode" type="text"  maxlength="9" onblur="pesquisacep(this.value)">
                           <label for="zipcode">
                           <i class="material-icons" style="font-size: 15px">place</i>&nbsp;CEP </label>
                        </div>
                        <div class="input-field col s7">
                           <input readonly="readonly" style="color: black;"id="addres" type="text" >
                           <label for="addres">Logradouro </label>
                        </div>
                        <div class="input-field col s2">
                           <input readonly="readonly" style="color: black;"id="number" type="text" >
                           <label for="number">Número </label>
                        </div>
                     </div>
                     <div class="col s12">
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="complement" type="text" >
                           <label for="complement">Complemento</label>
                        </div>
                        <div class="input-field col s5">
                           <input readonly="readonly" style="color: black;"id="district" type="text" >
                           <label for="district">Bairro</label>
                        </div>
                        <div class="input-field col s2">
                           <input readonly="readonly" style="color: black;"id="city" type="text" >
                           <label for="city">Cidade</label>
                        </div>
                        <div class="input-field col s2">
                           <input readonly="readonly" style="color: black;"id="uf" type="text"  maxlength="2">
                           <label for="uf">UF</label>
                        </div>
                     </div>
                  </div>
               </li>
               <li class="active" style="margin-top: 30px;" >
                  <div class="collapsible-header col s12" style=" justify-content: center; height: 50px; background-color: #76c076da; color: white;" >
                     <labe style="margin-top: 0.5em; font-size: 20px; font-weight: bold;">OBSERVAÇÕES</labe>
                  </div>
                  <div class="row" >
                     <div class="col s12"  style="margin-top: 10px;">
                        <div class="input-field col s12">
                           <input readonly="readonly" style="color: black;"id="obs" type="text">
                           <label for="obs">
                           <i class="material-icons" style="font-size: 15px">create</i>&nbsp;Observação</label>
                        </div>
                     </div>
                  </div>
               </li>
            </ul>
         </div>
         <div class="container" id="card_finance">
            <ul class="collapsible expandable " >
               <li class="active" id="cardFinance">
                  <div class="collapsible-header col s12" style=" justify-content: center; height: 50px; background-color: #76c076da; color: white;" >
                     <labe style="margin-top: 0.5em; font-size: 20px; font-weight: bold;">FINANCEIRO</labe>
                  </div>
                  <div class="row" >
                     <div class="col s12" style="margin-top: 10px;">
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="date_first" type="text" >
                           <label for="date_first" >Inicio do Processo</label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="date_end" type="text">
                           <label for="date_end" >Fim do processo</label>
                        </div>
                        <div class="input-field col s3" >
                           <div class="select-wrapper">
                              <input readonly="readonly" style="color: black;"id="statusProgresso" type="text">
                           <label for="statusProgresso" >Status do Progresso</label>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="row" >
                     <div class="col s12"  style="margin-top: 10px;">
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="cust_alv" type="tel" placeholder="R$" >
                           <label for="cust_alv">
                           <i class="material-icons" style="font-size: 15px">attach_money</i>&nbsp;Custo Alvaro</label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="val_w_lab" type="tel" placeholder="R$" >
                           <label for="val_w_lab">
                           <i class="material-icons" style="font-size: 15px">attach_money</i>&nbsp;Valor WorkLab</label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="val_pago" type="tel" placeholder="R$" >
                           <label for="val_pago">
                           <i class="material-icons" style="font-size: 15px">attach_money</i>&nbsp;Valor Pago</label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"style="color: black; border-bottom: none;" id="porcentagem" type="text">
                           <label for="porcentagem" class="active">
                           <i class="material-icons" style="font-size: 15px">attach_money</i>&nbsp;Acima ou abaixo de 40%</label>
                        </div>
                     </div>
                  </div>
                  <div class="row">
                     <div class="col s12">
                        <div class="input-field col s3">
                           <input readonly="readonly"style="color: black;" id="date_repass" type="date" >
                           <label for="date_repass" >Data repasse</label>
                        </div>
                        <div class="input-field col s3">
                           <input readonly="readonly" style="color: black;"id="n_nf" type="tel" >
                           <label for="n_nf">
                           <i class="material-icons" style="font-size: 15px">create</i>&nbsp;Nº Nota Fiscal</label>
                        </div>
                     </div>
                  </div>
               </li>
               <li class="active" style="margin-top: 30px;">
                  <div class="collapsible-header col s12" style=" justify-content: center; height: 50px; background-color: #76c076da; color: white;" >
                     <labe style="margin-top: 0.5em; font-size: 20px; font-weight: bold;">ANEXOS</labe>
                  </div>
                  <div class="row">
                     <div class="col s12">
                        <div class="col s4 mt-2 ml-3">
                           <input id="n_nf" type="file">
                        </div>
                        <div class="input-field col s3" >
                           <div class="select-wrapper">
                              <select name="select" id="tp_anx" class="error"  data-show="search">
                                 <option value="">Tipo do Anexo</option>
                                 {% for k in arr_SearchTypeAnexo%}
                                 <option value="{{ k.id }}">{{ k.tipo_anexo }}</option>
                                 {% endfor %}                              
                              </select>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="row">
                     <div class="col s11 ml-4">
                        <table class="bordered" style="margin-top: 20px;">
                           <thead style="background-color: #76c076da; color: white; font-size: 15px" >
                              <tr>
                                 <th data-field="id"> Arquivos Anexados</th>
                                 <th data-field="id"> Data e hora</th>
                                 <th data-field="id"> Tipo</th>
                                 <th data-field="name" style="width: 120px;">Ação</th>
                              </tr>
                           </thead>
                           <tbody id="tb_append">
                              <tr>
                                 <td>teste</td>
                                 <td>teste</td>
                                 <td>teste</td>
                                 <td style="text-align: center;">
                                    <button id="viewM" class="btn mb-1 waves-effect waves-light ativ" type="submit" name="action" style=" width: 15px;padding: 1;padding-right: 8px; background-color: #f5bd46da;">
                                       <i class="material-icons right">edit</i>
                                    </button>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div>
               </li>
               <li class="active" style="margin-top: 40px;" >
                  <div class="collapsible-header col s12" style=" justify-content: center; height: 50px; background-color: #76c076da; color: white;" >
                     <labe style="margin-top: 0.5em; font-size: 20px; font-weight: bold;">OBSERVAÇÕES</labe>
                  </div>
                  <div class="row" >
                     <div class="col s12"  style="margin-top: 10px;">
                        <div class="input-field col s12">
                           <input readonly="readonly" style="color: black;"id="obsF" type="text">
                           <label for="obsF">
                           <i class="material-icons" style="font-size: 15px">create</i>&nbsp;Observação</label>
                        </div>
                     </div>
                  </div>
               </li>
               <li class="active" style="margin-top: 30px;" >
                  <div class="collapsible-header col s12" style=" justify-content: center; height: 50px; background-color: #76c076da; color: white;" >
                     <labe style="margin-top: 0.5em; font-size: 20px; font-weight: bold;">HISTÓRICO</labe>
                  </div>
                  <div class="row" >
                     <div class="col s12"  style="margin-top: 10px;">
                        <div id="activity" class="col s12 active" style="display: block;">
                           <div class="activity">
                              <p class="mt-5 mb-0 ml-5 font-weight-900">SYSTEM LOGS</p>
                              <ul class="widget-timeline mb-0">
                                 <li class="timeline-items timeline-icon-green active">
                                    <div class="timeline-time">data e hora</div>
                                    <h6 class="timeline-title">Nome da pessoa</h6>
                                    <p class="timeline-text">Ação realizada</p>
                                 </li>
                                 <li class="timeline-items timeline-icon-cyan active">
                                    <div class="timeline-time">data e hora</div>
                                    <h6 class="timeline-title">Nome da pessoa</h6>
                                    <p class="timeline-text">Ação realizada</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div>
                  </div>
               </li>
            </ul>
         </div>
      </div>
   </div>
   <div class="modal-footer">
      <!--BUTTON-->
      <div class="col s12 ">
        <div class="col s10"></div>
        
      <div class="col s2">
         <a href="#!" class=" btn modal-trigger modal-action modal-close waves-effect" style="border-color: #dcdcdc; position: relative; transition: color 0.15s, background-color 0.15s, border-color 0.15s, box-shadow 0.15s; color: #212529; background-color: #eee; border-color: #eee; font-size: 0.8rem; font-weight: 500;"><span style="font-size: 16px">FECHAR</span></a>
      </div>

   </div>
   </div>
</div>
<div class="breadcrumbs-dark pb-0 pt-4" id="breadcrumbs-wrapper">
<!--FIM DO MODAL-->
<div class="breadcrumbs-dark pb-0 pt-4" id="breadcrumbs-wrapper">
<div class="container">
   <div class="card" >
      <div class="card-content" style="margin-top: -93px;">
         <h5 class="corfont">REEMBOLSO FINALIZADO</h5>
      </div>
   </div>
</div>
<div class="container">
<div class="card" >
   <!-- Externo -->
   <div id="userint" class="row" >
      <div class="col s12"  style="margin-top: 30px; margin-bottom: 30px;">
         <div class="input-field col s4">
            <input id="cpf" type="text" onkeyup="searchPatients(this)">
            <label for="cpf">
            <i class="material-icons" style="font-size: 15px">person</i>&nbsp;Buscar... </label>
         </div>
         <div class="input-field col s2">
            <select name="select" id="tp_anx" class="error" >
               <option value="">Selecione um mês</option>
               <option value="">Janeiro</option>
            </select>
         </div>
         <div class="col s2">&nbsp;
            <button id="pesq_agenda" class="waves-effect waves dark btn next-step" type="button" style="width: 100%;">
               <span style="font-weight: bold; color: white; font-family:Verdana, Geneva, Tahoma, sans-serif">Pesquisar</span>
            </button>
         </div>
         <!-- COMEÇO DA TABLE -->
         <div class="col s12" style="margin-top: 30px;">
            <table id="page-length-option" class="bordered">
               <thead style="background-color: #581848; color: white; font-size: 15px" >
                  <tr>
                     <th data-field="id">Paciente</th>
                     <th data-field="id" style="text-align: center;">Comercial</th>
                     <th data-field="id" style="text-align: center;" >Médico</th>
                     <th data-field="id" style="text-align: center;">Data Concluído</th>
                     <th data-field="id" style="text-align: center; width: 130px;">Status Coleta</th>
                     <th data-field="id" style="text-align: center; width: 130px;">Status Processo</th>
                     <th data-field="name" style="text-align: center; width: 80px;">Ação</th>
                  </tr>
               </thead>
               <tbody id="tb_append">
                  {% for k in arr_SearchRefundCompleted %}
                  <tr id="tr_{{ k.id }}">
                     <td>{{ k.paciente }}</td>
                     <td style="text-align: center;">{{ k.comercial }}</td>
                     <td style="text-align: center;">{{ k.medico }}</td>
                     <td style="text-align: center;">{{ k.dataconc }}</td>
                     <td style="text-align: center;">{{ k.status }}</td>
                     <td style="text-align: center;">{{ k.status_p }}</td>
                     <td style="text-align: center;">
                        <a href="#modal1" class="modal-trigger" data-id_user="{{ k.id }}" onclick="viewUserModal(this)">
                           <i class="material-icons" style="color: #f1ff29; margin-left: 3px;">remove_red_eye</i>
                        </a>
                     </td>
                  </tr>
                  {% endfor %}
               </tbody>
            </table>
         </div>
         <!-- FIM DA TABLE -->
      </div>
   </div>
</div>


<script type = "text/javascript" >

//FUNCTION BUSCAR
function searchPatients(object) {
    var e = $(object).val().toUpperCase();
    if (e == "") {
        $('#tb_append > tr').each(function() {
            $(this).show();
        });
    } else {
        $('#tb_append > tr').each(function() {
            var trs = $(this).find("td");
            var tr1 = $(trs[0]).text().toUpperCase();
            var check = (tr1.indexOf(e) != -1);
            if (check == true) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    }
}


//CONFIG MODAL
$(document).ready(function() {
    $('.modal').modal();
    $('.modal').css({
        "width": "80%",
    });
}); 


//ABRIR MODAL PRINCIPAL
function viewUserModal(object) { //FUNCTION DO ONCLICK
    var id_user = $(object).data("id_user"); //objeto usuario que compoe um data-id_user
    $("#btn_salvar").data("id_user", id_user); // para ter o data, precisa conter os seguintes parametros: elemento, key, value
    
    var formpost = {
        "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(),
        "id_user": id_user //DICT COM O VALOR DO ID
    };

    fetchRequest("{% url 'SearchModalExams' %}", "POST", "JSON", formpost, function(re) { // A URL É COMPOSTA PELO NAME DE UMA URL
        if (re["response"] == false) {
            alert("Nenhum dado encontrado."); // VERIFICA SE A INFO É VÁLIDA, SE NÃO, MESSAGE
        } else { //SE FOR VERDADDEIRA, PROSSEGUE
            console.log("re", re);
            var key = re["message"]; // NO DECORATOR, A MENSAGEM RETORNA O VALOR DO DICT, NESSE CASO É DECLARADO EM UM DICT: "id_campo" : key[valor-do-grupo][valor-do-key]
            var dictKeys = { // nome id / nome do grupo/ nome do value
                "statusM": key["obs"]["statusM"],
                "motivo_S": key["obs"]["motivo_status"],
                "date_age": key["agendamento"]["data_agendamento"],
                "hr_age": key["agendamento"]["hr_agendamento"],
                "tp_service": key["agendamento"]["tipo_servico"],
                "tp_exame": key["agendamento"]["tipo_exame"],
                "tp_conv": key["agendamento"]["convenio"],
                "driver": key["agendamento"]["motorista"],
                "doctor": key["agendamento"]["doctor"],
                "nurse": key["agendamento"]["nurse"],
                "resp_comercial": key["agendamento"]["commerce"],
                "id": key["agendamento"]["id"],
                "tel1": key["pessoal"]["phone1"],
                "tel2": key["pessoal"]["phone2"],
                "namePaciente": key["pessoal"]["paciente"],
                "attendance": key["pessoal"]["atendimento"],
                "zipcode": key["endereco"]["cep"],
                "addres": key["endereco"]["rua"],
                "number": key["endereco"]["numero"],
                "complement": key["endereco"]["complemento"],
                "district": key["endereco"]["bairro"],
                "city": key["endereco"]["cidade"],
                "uf": key["endereco"]["uf"],
                "obs": key["obs"]["obs"],
                "color_s": key["obs"]["color"],
            }

            $.map(dictKeys, function(n, i) { // map é usado para traduzir ou mapear os elementos de um array para outro conjunto de valores
                $(`#${i}`).val(n);
                var findLabel = $(`#${i}`).closest("div");
                $(findLabel).find("label").attr("class", "active");
            });
            $("#btn_start").data("id_user", id_user); //PEGA O ID DO PACIENTE
            $("#btn_end").data("id_user", id_user); //PEGA O ID DO PACIENTE
            $("#btn_salvar").data("id_user", key["id"]); //ATRIBUI UM NOVO VALOR PARA O ID


        }
    });



// MODAL FINANCEIRO
      var id_user = $(object).data("id_user"); //objeto usuario que compoe um data-id_user
      console.log(id_user)
      var formpost = {
         "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(),
         "id_user": id_user //DICT COM O VALOR DO ID
      };

     fetchRequest("{% url 'SearchModalExamsFinances' %}", "POST", "JSON", formpost, function(re) { // A URL É COMPOSTA PELO NAME DE UMA URL
        //AQUI .MAP 
        if (re["response"] == false) {
            alert("Nenhum dado encontrado."); // VERIFICA SE A INFO É VÁLIDA, SE NÃO, MESSAGE
        } else { //SE FOR VERDADDEIRA, PROSSEGUE
            var key = re["message"]; // NO DECORATOR, A MENSAGEM RETORNA O VALOR DO DICT, NESSE CASO É DECLARADO EM UM DICT: "id_campo" : key[valor-do-grupo][valor-do-key]
            console.log(key);
            var dictKeys = { // nome id / nome do grupo/ nome do value
                "date_first": key["dados"]["date_start"],
                "date_end": key["dados"]["date_end"],
                "statusProgresso": key["dados"]["status_process"],
                "cust_alv": key["dados"]["val_alvaro"],
                "val_w_lab": key["dados"]["val_work"],
                "val_pago": key["dados"]["val_pago"],
                "date_repass": key["dados"]["date_repasse"],
                "n_nf": key["dados"]["nf"],
                "porcentagem": key["dados"]["por_paga"],
            }

            $.map(dictKeys, function(n, i){ // map é usado para traduzir ou mapear os elementos de um array para outro conjunto de valores
               $(`#${i}`).val(n); // n simboliza o valor e i simboliza a key
               var findLabel = $(`#${i}`).closest("div"); // essa variavel serve para procurar um valor e atribuir o módulo closest div
               $(findLabel).find("label").attr("class", "active");//serve para encontrar dentro do closest div uma label e atribuir o módulo attr(atributo, valor)
               
               if(i == "statusProgresso"){//GAMBIARRA PARA INPUTAR O SELECT
                  var valueObject = $("#statusProgresso option:selected").text();
                  $("input[class='select-dropdown dropdown-trigger']").val(valueObject);
                  $('li[class="selected"]').attr("class", "");
                  var findObject = $(`span:contains(${valueObject})`).closest("li");
                  $(findObject).attr("class", "selected");
               }
            });


            $("#btn_start").data("id_user", id_user); //PEGA O ID DO PACIENTE

        }
    });

}

</script>
{% endblock %}
{% extends 'base.html' %}
{% load static %}
{% block title %}Shiloh | Exames Concluídos{% endblock %}
{% block icon-page %} 
metismenu-icon lnr-apartment icon-gradient bg-sunny-morning
{% endblock %}
{% block title-page %}
Página inicial
{% endblock %}
{% block description-page %}SOLICITAÇÕES DE REEMBOLSO{% endblock %}

{% block content %}
<style type="text/css">
   .scroll-y{
   height: 505px;
   max-height: 505px;
   overflow-y: scroll;
   }

   .tabs .indicator {
    position: absolute;
    bottom: 0;
    height: 2px;
    background-color: #581848;
    will-change: left,right;
}

.tabs .tab a.active, .tabs .tab a:hover {
    color: #750c97;
    background-color: transparent;
}

.tabs .tab a {
    font-size: 14px;
    display: block;
    overflow: hidden;
    width: 100%;
    height: 100%;
    padding: 0 24px;
    -webkit-transition: color .28s ease,background-color .28s ease;
    transition: color .28s ease,background-color .28s ease;
    color: rgb(0 0 0 / 87%);
}
</style> 

<div id="ModalCardPrincipal" class="modal modal-fixed-footer" style="width: 85%; height: 90%;max-height: 85%">
    {% include '../exams/partials/_modal_principal.html' %}
</div>

<div id="modalFinalizado" class="modal modal-fixed-footer" style="width: 85%; height: 90%;max-height: 85%">
    {% include '../exams/partials/_modal_solicitacoes_finalizadas.html' %}
</div>



<div class="breadcrumbs-dark pb-0" >
    <!--NEW CARD-->
    <div class="row container m-0">
    <div class="col s12 m3">
        <div class="card padding-4 animate fadeLeft">
            <div class="row">
                <div class="col s12 m12">
                    <div class="row">
                        <div class="col s6 m6 left-align">
                            <p class="mb-0 " style="font-size: 20px;margin-top: 10px;">Pendente</p>
                        </div>
                        <div class="col s6 m6 right-align">
                            {% for k in arr_Dash_reemsolso_pendente %}
                            <h5 class="mb-0">{{ k.pendentes }}</h5>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s6 m8 left-align">
                            <p class="mb-0 " style="font-size: 20px;margin-top: 10px;">À finalizar</p>
                        </div>
                        <div class="col s6 m4 right-align">
                            {% for k in arr_Dash_reemsolso_pago %}
                            <h5 class="mb-0">{{ k.pago }}</h5>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col s12 m3">
        <div class="card padding-4 animate fadeLeft">
            <div class="row">
                <div class="col s12 m12">
                    <div class="row">
                        <div class="col s6 m6 left-align">
                            <p class="mb-0 " style="font-size: 20px;margin-top: 10px;">Em Andamento</p>
                        </div>
                        <div class="col s6 m6 right-align">
                            {% for k in arr_Dash_reembolso_andamento %}
                            <h5 class="mb-0">{{ k.andamento }}</h5>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s6 m4 left-align">
                            <p class="mb-0 " style="font-size: 20px;margin-top: 10px;"> Análise</p>
                        </div>
                        <div class="col s6 m8 right-align">
                            {% for k in arr_Dash_reembolso_analise %}
                            <h5 class="mb-0">{{ k.analise }}</h5>
                            {% endfor %}
                        </div>
                    </div> 
                </div>
            </div>
        </div>
    </div>
    <div class="col s12 m3">
        <div class="card padding-4 animate fadeLeft">
        <div class="row">
            <div class="col s12 m12">
                <div class="row">
                    <div class="col s6 m6 left-align">
                        <p class="mb-0 " style="font-size: 20px;margin-top: 10px;">Glosa</p>
                    </div>
                    <div class="col s6 m6 right-align">
                        {% for k in arr_Dash_reemsolso_glosa %}
                        <h5 class="mb-0">{{ k.glosa }}</h5>
                        {% endfor %}
                    </div>
                </div>
                <div class="row">
                    <div class="col s6 m8 left-align">
                        <p class="mb-0 " style="font-size: 20px;margin-top: 10px;">Não Atingido</p>
                    </div>
                    <div class="col s6 m4 right-align">
                        {% for k in arr_Dash_reemsolso_nao_atingido %}
                        <h5 class="mb-0">{{ k.nao_atingido }}</h5>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
    <div class="col s12 m3">
        <div class="card padding-4 animate fadeLeft">
            <p class="no-margin">&nbsp;</p>
            <div class="row">
                <div class="col s6 m4 left-align">
                    <p class="mb-0 " style="font-size: 20px;margin-top: 10px;">Total</p>
                </div>
                <div class="col s6 m8 right-align">
                    {% for k in arr_Dash_reembolso_total %}
                    <h5 class="mb-0">{{ k.qtd }}</h5>
                    {% endfor %}
                </div>
            </div>
            <p class="no-margin">&nbsp;</p>
        </div>
    </div>
    </div>
    <!--FINISH CARD-->
</div> 
<div class="container">
    <div class="card">
        <div class="container">
            <div class="row">
                <div class="col s12" style="margin-top:20px">
                  <ul class="tabs">
                    <li class="tab col m3"><a class="active" href="#solicitacao_pendente">Pendente / Pago</a></li>
                    <li class="tab col m3"><a href="#solicitacao_andamento_analise">Em Andamento / Análise</a></li>
                    <li class="tab col m3"><a href="#solicitacao_glosa_n_atingido">Glosa / Não Atingido</a></li>
                    <li class="tab col m3"><a href="#solicitacao_finalizada">Finalizado</a></li>
                  </ul>
                </div>
            </div>
        </div>
        <div  class="row" >
            <div class="container">
                <div class="container scroll">
                    <div class="col s12 m12" style="overflow-x: auto;">
                        {% include '../exams/partials/_solicitacoes_pendentes.html' %}
                        {% include '../exams/partials/_solicitacoes_em_andamento_analise.html' %}
                        {% include '../exams/partials/_solicitacoes_glosa_n_atingido.html' %}
                        {% include '../exams/partials/_solicitacoes_finalizadas.html' %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<link href="{% static 'css/dataTables.bootstrap4.min.css' %}" rel="stylesheet">
<script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'js/dataTables.bootstrap4.min.js' %}"></script>
<script type="text/javascript" src="/app-assets/js/jquery.mask.js"></script>
<script type = "text/javascript" >

//CONFIG MODAL
$(document).ready(function() {
    $('.modal').modal();
    $('.modal').css({
        "width": "80%",
    });
});

    var datatableReembolso = $(".pagelengthoption").DataTable({
        "ordering" : true,
        "scrollCollapse" : true,
        "searching" : true,
        "columnDefs" : [{orderable: true, targets: 0 }],
    });
    $(".dropdown-trigger").css("display", "none")

    $(document).ready(function(){ // <<<< execute a seguinte função
        function changeTable() {
            $(".select-wrapper").find("select").hide();
            $(".dataTables_length").css({
                "width": "60px",
                "position": "relative",
            })

            showLoadingPage("close");
        }
        setTimeout(showLoadingPage("show"), 500);
        setTimeout(showLoadingPage("show"), 1000);
        setTimeout(changeTable, 200);
    });


// CARD DO FINANCEIRO - INICIAR REEMBOLSO
function ShowFinance(object) {
    $("#btn_start").attr("disabled", true);
    var id_user = $(object).data("id_user");
    var statusProgresso = $("#statusProgresso").val();
    var formpost = {
        "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(),
        "id_user": id_user,//DICT COM O VALOR DO ID
    };

    fetchRequest("{% url 'ApiStartProcess' %}", "POST", "JSON", formpost, function(re) {
        if (re["response"] == "true"){
        var dados = re["dadoss"];
            alert(re["message"]);
                $("#btn_start").hide();
                $("#card_finance").show();
                $("#statusProgresso").val(dados["statusProgresso"]).attr("selected","selected");
                $("#date_first").val(dados["date_first"]);    
        }else{
            alert(re["message"]);
            $("#btn_start").attr("disabled", false);
        }
    });
}

//VISUALIZA O APPEND
function viewFile(object){
    var path = $(object).data("url");
    var filename = $(object).data("id");
    var a = document.createElement("a");
    a.href = "/docs/" + path;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
}
//RETIRA O FILE 
function removeFile(object) {
    var id_patient = $(object).data("id_patient");
    var id_file = $(object).data("id");
    var type_file = $(object).data("type");

    var formpost = {
        "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(),
        "id_file": id_file,
        "type_file": type_file,
        "id_patient": id_patient
    };

    fetchRequest("{% url 'ModalExamsFinanceFileRemove' %}", "POST", "JSON", formpost, function(re) { // A URL É COMPOSTA PELO NAME DE UMA URL
        if (re["response"] == "true") {
            $(object).closest("tr").remove();
        }
        alert(re["message"]);
    });
}

    $("#doc_anx").click(function(){
    $("#doc_anx").val("");
    });
    function removeFileExists(object){
    $(object).closest("tr").remove();
    $("#doc_anx").val("");
    }


//BTN ATUALIZAR - SALVAR
function UpdateModal(object) {
    $("#btn_salvar").attr("disabled", true);

    var id_user = $(object).data("id_user");
    var cust_alv = $("#cust_alv").val().replace(",", "|").replace(".", "").replace("|", ".").replace("R$", "");
    var val_w_lab = $("#val_w_lab").val().replace(",", "|").replace(".", "").replace("|", ".").replace("R$", "");
    var val_pago = $("#val_pago").val().replace(",", "|").replace(".", "").replace("|", ".").replace("R$", "");
    var porcentagem = $("#porcentagem").val().replace("%", "");
    var data_repasse = $("#data_repasse").val();
    var n_nf = $("#n_nf").val();
    var obsF = $("#obsF").val();
    var files = $("#doc_anx")[0].files[0];
    var statusProgresso = $("#statusProgresso").val();

    if (statusProgresso == ""){
        var statusProgresso = $("#statusProgresso").val("1");
    }
    var Csrftoken = $('input[name="csrfmiddlewaretoken"]').val();
    var formpost2 = {
        "id_user": id_user,
        "data_repasse": data_repasse,
        "n_nf": n_nf,
        "statusProgresso": statusProgresso,
        "obsF": obsF,
    };
    var formpost = [{
            "name": "csrfmiddlewaretoken",
            "value": $('input[name="csrfmiddlewaretoken"]').val()
        },
        {
            "name": "id_user",
            "value": id_user
        },
        {
            "name": "obsF",
            "value": obsF
        },
        {
            "name": "statusProgresso",
            "value": statusProgresso
        },
        {
            "name": "cust_alv",
            "value": cust_alv
        },
        {
            "name": "val_w_lab",
            "value": val_w_lab
        },
        {
            "name": "val_pago",
            "value": val_pago
        },
        {
            "name": "porcentagem",
            "value": porcentagem
        },
        {
            "name": "data_repasse",
            "value": data_repasse
        },
        {
            "name": "data",
            "value": JSON.stringify(formpost2)
        },
    ];
    fetchRequestFiles("{% url 'SaveEditionsFinances' %}", "POST", "JSON", formpost, function(re) {
        if (re["response"] == false) {
            $("#btn_salvar").attr("disabled", false);
            alert("Não foi possível salvar informações."); // VERIFICA SE A INFO É VÁLIDA, SE NÃO, MESSAGE
        } else { //SE FOR VERDADDEIRA, PROSSEGUE
            $("#btn_salvar").attr("disabled", true);
            alert(re["message"]);
            location.reload();
        }
    });
}



function CalVal(valor) {
    var valWork = $("#val_w_lab").val();
    var valPago = $("#val_pago").val();
    var valWork = (valWork + ".").replaceAll(".", "");
    try {
        valWork = (valWork).replaceAll(",", "");
    } catch (e) {
        // declarações para manipular quaisquer exceções
        logMyErrors(e); // passa o objeto de exceção para o manipulador de erro
    }
    valWork = parseFloat(valWork);
    valPago = (valPago + ".").replaceAll(".", "");
    try {
        valPago = (valPago).replaceAll(",", "");
    } catch (e) {
        logMyErrors(e);
    }

    valPago = parseFloat(valPago);
    var soma = valPago * 100 / valWork;
    var result = Number(soma).toFixed(2)
    if (isNaN(result)) {
        return false;
    }
    $("#porcentagem").val(result + ' %');
    $("#labelporcentagem").attr("class", "active");
} 


//FINALIZAR PROCESSO
function FinalizeProcess(object) {
    $("#btn_end").attr("disabled", true);
    //VALIDAÇÃO DE CAMPO NULL
    var i = 0;
    $("#cardFinance input[data-required='true']").each(function() {
        if ($(this).val() == "") {
            alert("Preencha os campos obrigatórios. E verifique há Nota Fiscal anexada.");
            $("#btn_end").attr("disabled", false);
            $(this).focus();
            i = 1;
            return false;
        }
    });
    if (i == 1) {
        return false;
    }

    var id_user = $(object).data("id_user");
    var statusProgresso = $("#statusProgresso").val();
    var ValorPago = $("#val_pago").val();
    var doctor = $("#doctor").val();
    var namePaciente = $("#namePaciente").val();
    var resp_comercial = $("#resp_comercial").val();
    var data_repasse = $("#data_repasse").val();
    var date_age = $("#date_age").val();
    var tp_exame = $("#tp_exame").val();
    var company = $("#company").val();

    
    if (statusProgresso == "4"){
        var i = 0;
        $("#porcentagem").attr("data-required='true'");
        $("#cardFinance input[data-required='true']").each(function() {
            if ($(this).val() == "") {
                alert("Preencha os campos obrigatórios. E verifique há Nota Fiscal anexada.");
                $("#btn_salvar").attr("disabled", false);
                $(this).focus();
                i = 1;
                return false;
            }
        });
        if (i == 1) {
            return false;
        }
    }

    var formpost = {
        "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(),
        "id_user": id_user, 
        "statusProgresso": statusProgresso,
        "ValorPago": ValorPago,
        "doctor": doctor,
        "paciente": namePaciente,
        "comercial": resp_comercial,
        "data_repasse": data_repasse,
        "date_age": date_age,
        "tp_exame": tp_exame,
        "company": company,
    };

    fetchRequest("{% url 'ApiFinalizeProcess' %}", "POST", "JSON", formpost, function(re) {
        if (re["response"] == "true") {
            alert(re["message"]);
            $("#btn_end").attr("disabled", true);
            location.reload();
        }else{
            alert(re["message"]);
            $("#btn_end").attr("disabled", false);
        }
    });
}

    $("#val_w_lab").mask('#.##0,00', {
        reverse: true
    });
    $("#val_pago").mask('#.##0,00', {
        reverse: true
    });
    $("#cust_alv").mask('#.##0,00', {
        reverse: true
    });

function AnxDoc(object) {
    $("#anx_file").attr("disabled", true);
    var timeElapsed = Date.now();
    var today = new Date(timeElapsed);
    var id_user = $(object).data("id_user"); // id do paciente
    var typeFile = $("#tp_anx option:selected").text(); 
    var name_file = $('#doc_anx').val().split('\\').pop();
    var data = today.toLocaleDateString();
    var files = $("#doc_anx")[0].files[0];

    if ($("#doc_anx").val() != "") {    //verificação para preencher o tipo do arquivo.
        if ($("#doc_anx").prop("files") != undefined) {
            if ($("#tp_anx").val() == "") {
                return alert("Preencha o tipo de anexo para prosseguir.");
            } else {
                files = document.querySelector("#doc_anx").files[0];
            }
        } else {
            files = "";
        }
    } else {
        files = "";
    }
    
   
   var Csrftoken = $('input[name="csrfmiddlewaretoken"]').val(); 
    var formpost2 = {
        "id_user": id_user,
    };
    var formpost = [{
            "name": "csrfmiddlewaretoken",
            "value": $('input[name="csrfmiddlewaretoken"]').val()
        },
        {
            "name": "file",
            "value": files
        },
        {
            "name": "id_user",
            "value": id_user
        },
        {
            "name": "type_doc",
            "value": $("#tp_anx").val()
        },
        {
            "name": "data",
            "value": JSON.stringify(formpost2)
        },
    ];
    console.log(formpost)
    fetchRequestFiles("{% url 'ApiAnexarFiles'  %}", "POST", "JSON", formpost, function(re) {
        if (re["response"] == false) {
            $("#anx_file").attr("disabled", false);
            alert("Nenhum dado encontrado.");
        }else{
            $("#anx_file").attr("disabled", false);
          var append = `
            <tr> 
                <td>${name_file}</td>
                <td>${data}</td>
                <td>${typeFile}</td>
                <td style="text-align: center;">
                    <a onclick=\"removeFileExists(this)\" style="cursor: pointer; width: 15px;padding: 1;padding-right: 8px; background-color: #c74d4d;" href="#" data-path="/patients/process/111/2/Detran (1).pdf" class="btn mb-1 waves-effect waves-light ativ">
                        <i class="material-icons right">delete</i>
                    </a>
                </td>
            </tr>
            `;
            $("#tb_append").append(append);
            alert(re["message"]);
          }
        });
    }

    $("#anx_file").click(function(){
        AnxDoc(this);
    });

    $('#btn_card_coleta').on("click", function(){
        var a = $("#btn_card_coleta");
        a.next('#card_coleta').slideToggle();
    });

function ContratoFile(object){
    $(object).attr("disabled", true)
    var id_user = $(object).data("id_user");
    var formpost = {
        "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(),
        "id_user": id_user, //DICT COM O VALOR DO ID
    };

    fetchRequest("{% url 'FileContract' %}", "POST", "JSON", formpost, function(re) {
        if (re["response"] == true) {
            $(object).attr("disabled", false)

            var dados = re["message"];
            var path = dados
            var a = document.createElement("a");
            
            a.href = path;
            a.download = "termo.pdf";
            document.body.appendChild(a);
            a.click();
        }
        else{
            $(object).attr("disabled", false)
            alert(re["message"])
        }
    })
}

    $(document).ready(function(){
        $('tabs').tabs();
        });

//MODAL PRINCIPAL
function ModalPricipal(object) {
    var id_user = $(object).data("id_user");
    $("#btn_salvar").data("id_user", id_user);
    $("#btn_start").data("id_user", id_user);
    $("#anx_file").data("id_user", id_user);
    var formpost = {
        "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(),
        "id_user": id_user //DICT COM O VALOR DO ID
    };
   $("#load_principal").hide();
   $(object).prop("disabled", true);

   fetchRequest("{% url 'SearchModalExams' %}", "POST", "JSON", formpost, function (re) {
      if (re["response"] == false) {
         alert("Nenhum dado encontrado.");
      } else {
         $("#load_principal").show();
         var key = re["message"];
         var dictKeys = {
            "statusM": key["obs"]["statusM"],
            "motivo_S": key["obs"]["motivo_status"],
            "date_age": key["agendamento"]["data_agendamento"],
            "hr_age": key["agendamento"]["hr_agendamento"],
            "tp_service": key["agendamento"]["tipo_servico"],
            "tp_exame": key["agendamento"]["tipo_exame"],
            "tp_conv": key["agendamento"]["convenio"],
            "driver": key["agendamento"]["motorista"],
            "doctor": key["agendamento"]["doctor"],
            "nurse": key["agendamento"]["NomeNurse"],
            "resp_comercial": key["agendamento"]["commerce"],
            "id": key["agendamento"]["id"],
            "tel1": key["pessoal"]["phone1"],
            "tel2": key["pessoal"]["phone2"],
            "namePaciente": key["pessoal"]["paciente"],
            "attendance": key["pessoal"]["atendimento"],
            "company": key["pessoal"]["company"],
            "zipcode": key["endereco"]["cep"],
            "addres": key["endereco"]["rua"],
            "number": key["endereco"]["numero"],
            "complement": key["endereco"]["complemento"],
            "district": key["endereco"]["bairro"],
            "city": key["endereco"]["cidade"],
            "uf": key["endereco"]["uf"],
            "obs": key["obs"]["obs"],
            "color_s": key["obs"]["color"],
            "login": key["obs"]["login"],
            "senha": key["obs"]["senhaC"],
         }
         $.map(dictKeys, function (n, i) {
            $(`#${i}`).val(n);
            var findLabel = $(`#${i}`).closest("div");
            $(findLabel).find("label").attr("class", "active");
         });

         $("#btn_start").data("id_user", id_user); 
         $("#btn_end").data("id_user", id_user);
         $("#btn_salvar").data("id_user", key["id"]);
         $("#anx_file").data("id_user", key["id"]);

         //Verifica se está pendente ou em andamento, para aparecer a div
         try {
            var finances_exam = key["finances_exams"];
            var status_proccess = finances_exam["status"];

            if (status_proccess != "8") {
               $("#btn_start").hide();
               $("#card_finance").show();
               $("#btn_end").show();
               $("#btn_salvar").show();
            } else {
               $("#btn_start").show();
               $("#card_finance").hide();
               $("#btn_end").hide();
               $("#btn_salvar").hide();
            }
         } catch (e) {
            $("#btn_start").show();
            $("#card_finance").hide();
            $("#btn_end").hide();
            $("#btn_salvar").hide();
         }
      }
   });

   // MODAL FINANCEIRO
   var id_user = $(object).data("id_user");
   var formpost = {
      "csrfmiddlewaretoken": $('input[name="csrfmiddlewaretoken"]').val(),
      "id_user": id_user
   };

   $("#load_principal").hide();
   $(object).prop("disabled", true);
   fetchRequest("{% url 'SearchModalExamsFinances' %}", "POST", "JSON", formpost, function (re) {
      $(object).prop("disabled", false);
      if (re["response"] == false) {
         alert("Nenhum dado encontrado.");
      } else {
         $("#load_principal").show();
         var key = re["message"]; // NO DECORATOR, A MENSAGEM RETORNA O VALOR DO DICT, NESSE CASO É DECLARADO EM UM DICT: "id_campo" : key[valor-do-grupo][valor-do-key]
         var dictKeys = { // nome id / nome do grupo/ nome do value
            "date_first": key["dados"]["date_start"],
            "date_end": key["dados"]["date_end"],
            "statusProgresso": key["dados"]["status_process_id"],

            "cust_alv": key["dados"]["val_alvaro"],
            "val_w_lab": key["dados"]["val_work"],
            "val_pago": key["dados"]["val_pago"],
            "porcentagem": key["dados"]["por_paga"],

            "data_repasse": key["dados"]["data_repasse"],
            "n_nf": key["dados"]["nf"],
         }
         $.map(dictKeys, function (n, i) { // map é usado para traduzir ou mapear os elementos de um array para outro conjunto de valores
            $(`#${i}`).val(n); // n simboliza o valor e i simboliza a key
            var findLabel = $(`#${i}`).closest("div"); // essa variavel serve para procurar um valor e atribuir o módulo closest div
            $(findLabel).find("label").attr("class", "active"); //serve para encontrar dentro do closest div uma label e atribuir o módulo attr(atributo, valor)

            if (i == "statusProgresso") { //GAMBIARRA PARA INPUTAR O SELECT
               $(`#${i}`).val(n);
               var valueObject = $("#statusProgresso option:selected").text();
               var ob1 = $(`#${i}`).closest("div");
               var ob2 = ob1[0];
               $(ob2).find("input").val(valueObject);
            }
         });
         $("#btn_start").data("id_user", id_user); //PEGA O ID DO PACIENTE

         //AQUI INICIA FUNCTION APPEND FILE
         var filesResponse = JSON.parse(re["message"]["files"]);
         var ap = "";
         $.map(filesResponse, function (n, i) {
            ap += `
                <tr>
                    <td>${n.file.name}</td>
                    <td>${n.file.date_created.pt}</td>
                    <td>${n.description_type}</td>
                    <td style="text-align: center;">
                        <button data-url="${n.file.path}" data-id="${n.file.name}" onclick=\"viewFile(this)\" class="btn mb-1 waves-effect waves-light ativ" type="button" name="action" style=" width: 15px;padding: 1;padding-right: 8px; background-color: #f5bd46da;"><i class="material-icons right">cloud_download</i></button>
                        <button data-url="${n.file.path}" data-id_patient="${id_user}" data-type="${n.type}" data-id="${n.file.name}" onclick=\"removeFile(this)\" class="btn mb-1 waves-effect waves-light ativ" type="button" name="action" style=" width: 15px;padding: 1;padding-right: 8px; background-color: #c74d4d;"><i class="material-icons right">delete</i></button>
                    </td>
                </tr>
                `;
         });
         $("#tb_append").html(ap);

         //AQUI INICIA FUNCTION GET HISTORY
         var historyResponse = re["message"]["history"];
         var his = "";
         $.map(historyResponse, function (n, i) {
            his += `
                <li class="timeline-items timeline-icon-green active ">
                    <div id="data_f" class="timeline-time">${n.data_operacao}</div>
                    <h5 id="name_u" class="timeline-title">${n.nome_user}</h5>
                    <p id="action_f" class="timeline-text">${n.descricao}</p>
                </li>
                `;
         });
         $("#historico").html(his);
      }
   });
}
</script>
{% endblock %}